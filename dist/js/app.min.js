function initMap(){map=new google.maps.Map(document.getElementById("map"),{disableDefaultUI:!0}),window.mapBounds=new google.maps.LatLngBounds,google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(mapBounds)}),ko.applyBindings(new listViewModel)}function stringStartsWith(e,n){return e=e||"",n.length>e.length?!1:e.substring(0,n.length)===n}function listViewModel(){var e=this,n=null;e.itemToFilter=ko.observable(""),e.placesArray=ko.observableArray(placeData),e.pinAnimation=function(e,a){function t(){map.setCenter(e.getPosition()),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1900)}return function(){n===a?(t(e),a.close(map,this),map.fitBounds(mapBounds),n=null):(null!==n&&(n.close(map,this),t(e)),t(e),a.open(map,this),n=a)}},e.placesArray().forEach(function(a){a.marker=new google.maps.Marker({map:map,position:{lat:a.lat,lng:a.lng},title:a.name}),a.infoWindow=new google.maps.InfoWindow({content:a.name}),google.maps.event.addListener(a.marker,"click",e.pinAnimation(a.marker,a.infoWindow)),google.maps.event.addListener(a.infoWindow,"closeclick",function(){n=null,map.fitBounds(mapBounds)}),$.getJSON("https://api.foursquare.com/v2/venues/"+a.venue+"?client_id="+FOURSQUARE_API_CLIENT+"&client_secret="+FOURSQUARE_API_SECRET+"&v=20130815&ll=37.7,-122").done(function(e){var n=e.response.venue,t=n.hasOwnProperty("description")?n.description:"",o='<div class="infowindow"><h1>'+n.name+'</h1><div id="pic"><img src="'+n.bestPhoto.prefix+"210x210"+n.bestPhoto.suffix+'" alt="Image Location"></div><p><b>Category: </b>'+n.categories[0].name+"</p><p>"+t+"</p><p><b>Phone: </b>"+n.contact.formattedPhone+'</p><p><b>Address: </b> <a target="_blank" href=https://www.google.com/maps/dir/Current+Location/'+n.location.lat+","+n.location.lng+">"+n.location.formattedAddress+'</a></p><p><b>Source: </b><a target="_blank" href='+n.canonicalUrl+">Foursquare Page</a></div>";a.infoWindow.setContent(o)}).fail(function(){var e=a.name+"<h5>Foursquare data is unavailable. Please try again!</h5>";a.infoWindow.setContent(e)}),mapBounds.extend(new google.maps.LatLng(a.lat,a.lng)),map.fitBounds(mapBounds)}),e.markerClick=function(e){google.maps.event.trigger(e.marker,"click")},e.resetMarkers=function(){e.placesArray().forEach(function(e){e.marker.setVisible(!0),map.fitBounds(mapBounds)})},e.filteredItems=ko.computed(function(){var n=e.itemToFilter().toLowerCase();return n?ko.utils.arrayFilter(e.placesArray(),function(e){var a=stringStartsWith(e.name.toLowerCase(),n);return e.marker.setVisible(a),a}):(e.placesArray()[0].hasOwnProperty("marker")&&e.resetMarkers(),e.placesArray())})}var map,FOURSQUARE_API_CLIENT="J5B15DIFBQULDELDRC00BET5PTEUKTEFUMFDZ5HAYSY2P33R",FOURSQUARE_API_SECRET="XIH1G3153DXNXBNSEFUEHFCPTMY0YVAGK5LWGZJQOQFQKLMY",placeData=[{name:"Island Taqueria",venue:"4dd857ab2271c5d36d52eaf0",lat:37.765768,lng:-122.241637},{name:"South Shore Cafe",venue:"4bc20e70b492d13a3fdca660",lat:37.75757837706282,lng:-122.25251336681507},{name:"Speisekammer",venue:"463de5c9f964a5203f461fe3",lat:37.766064487213704,lng:-122.2401211982562},{name:"USS Hornet Museum",venue:"4a6cbe2df964a5207dd11fe3",lat:37.772453282779324,lng:-122.30214357376097},{name:"Kamakura Japanese Restaurant",venue:"4645be7ef964a5207f461fe3",lat:37.763658373312516,lng:-122.23850548267365}];